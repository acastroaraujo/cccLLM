---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  dpi = 300
)
```

# cccLLM

<!-- badges: start -->

[![R-CMD-check](https://github.com/acastroaraujo/cccLLM/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/acastroaraujo/cccLLM/actions/workflows/R-CMD-check.yaml)

<!-- badges: end -->

This package contains a collection of datasets about the Colombian Constitutional Court. Most of them were processed with the help of Large Language Models. It is meant to complement the datasets collected in the [ccc](https://acastroaraujo.github.io/ccc/) package.

## Installation

You can install the development version of cccLLM from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("acastroaraujo/cccLLM")
```

To cite `cccLLM` in publications use:

```{r, comment="", echo=FALSE}
toBibtex(citation("cccLLM"))
```

```{r court-cohorts, message=FALSE, warning=FALSE, fig.height = 8, fig.width = 7, echo=FALSE}
library(tidyverse)
library(slider)
library(patchwork)
library(cccLLM)

theme_set(theme_light(base_family = "Avenir Next Condensed", header_family = "Roboto Condensed Regular"))

lvls <- with(appointed_judges, str_to_title(name[order(start, end)]))

p1 <- appointed_judges |>
  mutate(name = str_to_title(name)) |>
  mutate(name = factor(name, lvls)) |>
  ggplot(aes(x = start, y = name)) +
  geom_segment(aes(xend = end)) +
  geom_text(
    mapping = aes(label = name),
    size = 2.5,
    hjust = 1,
    nudge_x = -200,
    family = "Avenir Next Condensed"
  ) +
  labs(
    x = NULL,
    y = NULL,
    caption = "\nAppointements, April 1992-2024"
  ) +
  scale_x_date(
    date_breaks = "2 years",
    date_labels = "'%y",
    expand = 0
  ) +
  coord_cartesian(
    clip = "off",
    xlim = as.Date(c("1992-01-01", "2024-04-03"))
  ) +
  theme(
    axis.text.y = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    plot.margin = margin(5.5, 5.5, 5.5, 120) # Add left margin for labels
  )

p2 <- rulings |>
  mutate(date = floor_date(date, "month")) |>
  count(date) |>
  mutate(
    avg = slide_index_dbl(
      .x = n,
      .i = date,
      .f = mean,
      .before = months(3),
      .after = months(3),
      .complete = TRUE
    )
  ) |>
  ggplot(aes(date)) +
  geom_line(aes(y = n), alpha = 1 / 4) +
  geom_line(aes(y = avg)) +
  scale_x_date(date_breaks = "2 years", date_labels = "'%y", expand = 0) +
  coord_cartesian(xlim = as.Date(c("1992-01-01", "2024-04-03"))) +
  labs(x = NULL, y = NULL, subtitle = "Monthly Rulings", title = "Colombian Constitutional Court") 

p2 / p1 + plot_layout(heights = c(2, 9), widths = c(7, 7))
```

## Convenience Functions

```{r}
library(cccLLM)

summary_ruling("C-370-06")
summary_ruling("SU-096-18")

print_article(11)
print_article(363)
```

## Dataset Examples

```{r}
glimpse(rulings)
glimpse(person)
glimpse(articles)
```

